# Structured Data Gradient Pruning (SDGP)
Weight pruning is a technique to make Deep Neural Network (DNN) inference more computationally efficient by reducing the number of model parameters over the course of training. However, most weight pruning techniques generally does not speed up DNN training and can even require more iterations to reach model convergence. In this work, we propose a novel Structured Data Gradient Pruning (SDGP) method that can speed up training without impacting model convergence. This approach enforces a specific sparsity structure, where only N out of every M elements in a matrix can be nonzero, making it amenable to hardware acceleration. Modern accelerators such as the Nvidia A100 GPU support this type of structured sparsity for 2 nonzeros per 4 elements in a reduction. Assuming hardware support for 2:4 sparsity, our approach can achieve a 15-25\% reduction in total training time without significant impact to performance.

## Implementation Details
Check out [sdgp.py](https://github.com/BradMcDanel/sdgp/blob/main/sdgp.py) for details on how the data gradients are pruned during backpropagation. To make the pruning more efficient under group-level sorting, we implemented our own [CUDA kernel](https://github.com/BradMcDanel/sdgp/blob/main/kernels/prune_kernel.cu). This is tested only with CUDA 11.3 and PyTorch 1.10.2 using Python 3.9.

## Training Configuration
Training generally follows the configuration details in the excellent [ffcv library](https://github.com/libffcv/ffcv-imagenet). To fit ImageNet in a system with 256 GB of RAM using the ffcv data loader, we decreased the image size and other settings from (500, 0.5, 90) which takes 337GB to (448, 0.60, 90) which takes 229GB. We did not observe any decrease in performance comapared to the results posted in the ffcv repository on either ResNet-18 or ResNet-50 using these slightly smaller images.

### CIFAR-10
| SDGP Prune Function | Non zeros | Group size | Top-1 Acc. |                                      Config                                      |                                      Checkpoint                                      |
|:-------------------:|:---------:|:----------:|:----------:|:--------------------------------------------------------------------------------:|:------------------------------------------------------------------------------------:|
| None (dense)        | 4         | 4          | 95.3       | [link](https://github.com/BradMcDanel/sdgp/blob/main/cfg/cifar/baseline.yaml)    | [link](https://drive.google.com/drive/u/0/folders/1cJrtgxaHJu9LS0mLyfLIOhUa-vQ6ZxiL) |
| Random              | 2         | 4          | 94.5       | [link](https://github.com/BradMcDanel/sdgp/blob/main/cfg/cifar/rnd_2_4.yaml)     | [link](https://drive.google.com/drive/u/0/folders/1WTbOshRtyqTRI2r0yxWgZA4EBy61qw88) |
| Magnitude           | 2         | 4          | 95.2       | [link](https://github.com/BradMcDanel/sdgp/blob/main/cfg/cifar/max_2_4.yaml)     | [link](https://drive.google.com/drive/u/0/folders/1GZg2h6xuvfw98_jnM-Ww5q1JAw-M8j6S) |
| Rescale Mag.        | 1         | 4          | 95.1       | [link](https://github.com/BradMcDanel/sdgp/blob/main/cfg/cifar/maxnorm_1_4.yaml) | [link](https://drive.google.com/drive/u/0/folders/1YfTKnqC1B1ySh4D0mB4ZIT6faeGutrHy) |
| Rescale Mag.        | 2         | 4          | 95.2       | [link](https://github.com/BradMcDanel/sdgp/blob/main/cfg/cifar/maxnorm_2_4.yaml) | [link](https://drive.google.com/drive/u/0/folders/1CpRDGKgHpGtQMMkcV5gKORVhEjYOT-a7) |
| Rescale Mag.        | 1         | 8          | 94.7       | [link](https://github.com/BradMcDanel/sdgp/blob/main/cfg/cifar/maxnorm_1_8.yaml) | [link](https://drive.google.com/drive/u/0/folders/11ikgWfXC2HfSs9rBV-ZN3GqG620mjSvm) |
| Rescale Mag.        | 2         | 8          | 95.1       | [link](https://github.com/BradMcDanel/sdgp/blob/main/cfg/cifar/maxnorm_2_8.yaml) | [link](https://drive.google.com/drive/u/0/folders/1HLhPO1X9XgrrAuN4vYe746PvJ-dl-o6h) |
| Rescale Mag.        | 4         | 8          | 95.2       | [link](https://github.com/BradMcDanel/sdgp/blob/main/cfg/cifar/maxnorm_4_8.yaml) | [link](https://drive.google.com/drive/u/0/folders/1SWv3rM6xRIYzZ69U7nbtKRLOuRf6gjNZ) |
| Rescale Mag.        | 2         | 16         | 95.1       | [link](https://github.com/BradMcDanel/sdgp/blob/main/cfg/cifar/maxnorm_2_16.yaml) | [link](https://drive.google.com/drive/u/0/folders/1_EOxmQjJY4h4r8CfNnWqeS7WmZSY3NJV) |
| Rescale Mag.        | 4         | 16         | 95.2       | [link](https://github.com/BradMcDanel/sdgp/blob/main/cfg/cifar/maxnorm_4_16.yaml) | [link](https://drive.google.com/drive/u/0/folders/1QfQcE2IGYs2eV8fWTu-XiFzSz3Nkg2A2) |
| Rescale Mag.        | 8         | 16         | 95.2       | [link](https://github.com/BradMcDanel/sdgp/blob/main/cfg/cifar/maxnorm_8_16.yaml) | [link](https://drive.google.com/drive/u/0/folders/1ab1xC2u8GWsJ2sAVkVmTinjSGriZIIDU) |
| Rescale Mag.        | 4         | 32         | 94.9       | [link](https://github.com/BradMcDanel/sdgp/blob/main/cfg/cifar/maxnorm_4_32.yaml) | [link](https://drive.google.com/drive/u/0/folders/1lEM5XRuTuC9SAj7_bfYMiWozhb8T9DpA) |
| Rescale Mag.        | 8         | 32         | 95.3       | [link](https://github.com/BradMcDanel/sdgp/blob/main/cfg/cifar/maxnorm_8_32.yaml) | [link](https://drive.google.com/drive/u/0/folders/1anL1tagtYuLIFLChXi0T9HX_IVgYNwW-) |
| Rescale Mag.        | 16        | 32         | 95.3       | [link](https://github.com/BradMcDanel/sdgp/blob/main/cfg/cifar/maxnorm_16_32.yaml) | [link](https://drive.google.com/drive/u/0/folders/1fO7xPZAf1nLpgo4-UOxHAPfgeRMV1RcL) |
